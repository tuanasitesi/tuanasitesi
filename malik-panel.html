<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Malik Paneli - Tuana Sitesi</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
  h1 { color: #1a73e8; }
  button { padding: 10px 20px; margin-bottom: 20px; cursor: pointer; }
  table { border-collapse: collapse; width: 100%; max-width: 900px; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #007bff; color: white; }
  .error { color: red; margin-top: 10px; }
</style>
</head>
<body>

<h1>Malik Paneli</h1>
<p>Kendi ödeme kayıtlarınız ve site genel gelir-gider bilgileri burada gösterilecek.</p>
<button onclick="logout()">Çıkış Yap</button>

<h2>Ödeme Kayıtları</h2>
<div id="paymentRecords">Yükleniyor...</div>

<h2>Site Genel Gelir-Gider</h2>
<div id="generalFinance">Yükleniyor...</div>

<script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbweq8coY48LrL1TlZrpr4Aqn3eqNUS30mj6d7cgFxePYVCoCAmWyEtHzCRJ5RZSoT0/exec'; // Apps Script URL

  function logout() {
    if (confirm("Çıkış yapmak istediğinize emin misiniz?")) {
      window.location.href = "giris.html"; // Giriş sayfasına yönlendir
    }
  }

  async function fetchData() {
    try {
      const res = await fetch(SCRIPT_URL);
      if (!res.ok) throw new Error("Veri alınamadı: " + res.statusText);
      const data = await res.json();
      return data;
    } catch (err) {
      throw err;
    }
  }

  function displayPayments(data, userEmail) {
    // userEmail kendi mail adresiniz olmalı, bu kısım kullanıcıya göre filtreleme için
    const userPayments = data.filter(row => row.MALİK.toLowerCase() === userEmail.toLowerCase());

    if (userPayments.length === 0) {
      return "<p>Ödeme kaydınız bulunamadı.</p>";
    }

    let html = '<table><tr>';
    // Tablo başlıkları
    for (const key in userPayments[0]) {
      html += `<th>${key}</th>`;
    }
    html += '</tr>';

    userPayments.forEach(row => {
      html += '<tr>';
      for (const key in row) {
        html += `<td>${row[key]}</td>`;
      }
      html += '</tr>';
    });

    html += '</table>';
    return html;
  }

  function displayGeneralFinance(data) {
    // Örnek basit toplam hesaplama (aylık toplam gelir ve gider)
    let totalGelir = 0;
    let totalGider = 0;

    data.forEach(row => {
      // Burada GELİR ve GİDER sütunları tam isimle uyumlu olmalı
      let gelir = parseFloat(row['GELİR (TL)'] || '0') || 0;
      let gider = parseFloat(row['GİDER (TL)'] || '0') || 0;
      totalGelir += gelir;
      totalGider += gider;
    });

    return `<p><strong>Toplam Gelir:</strong> ${totalGelir.toFixed(2)} TL</p>
            <p><strong>Toplam Gider:</strong> ${totalGider.toFixed(2)} TL</p>`;
  }

  async function init() {
    try {
      const userEmail = "malik@example.com"; // Burayı giriş yapan kullanıcının maili ile değiştirin

      const data = await fetchData();

      document.getElementById('paymentRecords').innerHTML = displayPayments(data, userEmail);
      document.getElementById('generalFinance').innerHTML = displayGeneralFinance(data);

    } catch (error) {
      document.getElementById('paymentRecords').innerHTML = `<p class="error">Ödeme kayıtları yüklenirken hata: ${error.message}</p>`;
      document.getElementById('generalFinance').innerHTML = `<p class="error">Site genel gelir-gider bilgisi yüklenirken hata: ${error.message}</p>`;
    }
  }

  init();
</script>

</body>
</html>
